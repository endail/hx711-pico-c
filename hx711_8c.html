<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hx711-pico-c: src/hx711.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hx711-pico-c
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('hx711_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hx711.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="hx711_8h_source.html">../include/hx711.h</a>&quot;</code><br />
<code>#include &quot;hardware/gpio.h&quot;</code><br />
</div>
<p><a href="hx711_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a20c562c58345b4cb4c8922925ec0a877"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a20c562c58345b4cb4c8922925ec0a877">hx711_init</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx, const uint clk, const uint dat, PIO const pio, const pio_program_t *const prog, <a class="el" href="hx711_8h.html#a90174ad7869dcc222ee9d6aef3e3b097">hx711_program_init_t</a> prog_init_func)</td></tr>
<tr class="memdesc:a20c562c58345b4cb4c8922925ec0a877"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise HX711.  <a href="hx711_8c.html#a20c562c58345b4cb4c8922925ec0a877">More...</a><br /></td></tr>
<tr class="separator:a20c562c58345b4cb4c8922925ec0a877"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a430408c58853bd2ec9b4e2bacb36f055"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a430408c58853bd2ec9b4e2bacb36f055">hx711_close</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx)</td></tr>
<tr class="memdesc:a430408c58853bd2ec9b4e2bacb36f055"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop communication with HX711.  <a href="hx711_8c.html#a430408c58853bd2ec9b4e2bacb36f055">More...</a><br /></td></tr>
<tr class="separator:a430408c58853bd2ec9b4e2bacb36f055"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02e3733a8c520e26cb44caac32945c63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a02e3733a8c520e26cb44caac32945c63">hx711_set_gain</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx, const <a class="el" href="hx711_8h.html#acadec7365abc52889994131164536304">hx711_gain_t</a> gain)</td></tr>
<tr class="memdesc:a02e3733a8c520e26cb44caac32945c63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets HX711 gain.  <a href="hx711_8c.html#a02e3733a8c520e26cb44caac32945c63">More...</a><br /></td></tr>
<tr class="separator:a02e3733a8c520e26cb44caac32945c63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a490345d56d3d9f06f809c07446a6e5"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a2a490345d56d3d9f06f809c07446a6e5">hx711_get_value</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx)</td></tr>
<tr class="memdesc:a2a490345d56d3d9f06f809c07446a6e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains a value from the HX711. Blocks until a value is available.  <a href="hx711_8c.html#a2a490345d56d3d9f06f809c07446a6e5">More...</a><br /></td></tr>
<tr class="separator:a2a490345d56d3d9f06f809c07446a6e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ab1a8852812daf235cf743f530cf037"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a0ab1a8852812daf235cf743f530cf037">hx711_get_value_timeout</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx, const uint timeout, int32_t *const val)</td></tr>
<tr class="memdesc:a0ab1a8852812daf235cf743f530cf037"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains a value from the HX711. Blocks until a value is available or the timeout is reached.  <a href="hx711_8c.html#a0ab1a8852812daf235cf743f530cf037">More...</a><br /></td></tr>
<tr class="separator:a0ab1a8852812daf235cf743f530cf037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c8ff19b682c8518252a5d6ed67d6598"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#a0c8ff19b682c8518252a5d6ed67d6598">hx711_get_value_noblock</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx, int32_t *const val)</td></tr>
<tr class="memdesc:a0c8ff19b682c8518252a5d6ed67d6598"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains a value from the HX711. Returns immediately if no value is available.  <a href="hx711_8c.html#a0c8ff19b682c8518252a5d6ed67d6598">More...</a><br /></td></tr>
<tr class="separator:a0c8ff19b682c8518252a5d6ed67d6598"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa47929fdc96d757b9306dd57ef752a20"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hx711_8c.html#aa47929fdc96d757b9306dd57ef752a20">hx711_set_power</a> (<a class="el" href="structhx711__t.html">hx711_t</a> *const hx, const <a class="el" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657">hx711_power_t</a> pwr)</td></tr>
<tr class="memdesc:aa47929fdc96d757b9306dd57ef752a20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the power state of the HX711.  <a href="hx711_8c.html#aa47929fdc96d757b9306dd57ef752a20">More...</a><br /></td></tr>
<tr class="separator:aa47929fdc96d757b9306dd57ef752a20"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a430408c58853bd2ec9b4e2bacb36f055"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a430408c58853bd2ec9b4e2bacb36f055">&#9670;&nbsp;</a></span>hx711_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hx711_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop communication with HX711. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00085">85</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                    {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    pio_sm_set_enabled(</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">false</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    pio_sm_unclaim(</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    pio_remove_program(</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a6582187b36ed9f636945d2af35232dbc">_prog</a>,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a0c14f4e62aa6ee1f56b941a87e214ce4">_offset</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="ttc" id="ahx711_8h_html_ae2674564ac2b0b3f0cfda56e0a970f07"><div class="ttname"><a href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a></div><div class="ttdeci">static void hx711__assert_hx_initd(hx711_t *const hx)</div><div class="ttdoc">Asserts that the hx has been properly initialised. Only calls assert().</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00288">hx711.h:288</a></div></div>
<div class="ttc" id="astructhx711__t_html_a0c14f4e62aa6ee1f56b941a87e214ce4"><div class="ttname"><a href="structhx711__t.html#a0c14f4e62aa6ee1f56b941a87e214ce4">hx711_t::_offset</a></div><div class="ttdeci">uint _offset</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00080">hx711.h:80</a></div></div>
<div class="ttc" id="astructhx711__t_html_a6582187b36ed9f636945d2af35232dbc"><div class="ttname"><a href="structhx711__t.html#a6582187b36ed9f636945d2af35232dbc">hx711_t::_prog</a></div><div class="ttdeci">const pio_program_t * _prog</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00077">hx711.h:77</a></div></div>
<div class="ttc" id="astructhx711__t_html_a77b81a68b9304dc653e393215beacd77"><div class="ttname"><a href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">hx711_t::_pio</a></div><div class="ttdeci">PIO _pio</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00076">hx711.h:76</a></div></div>
<div class="ttc" id="astructhx711__t_html_a8574e280638286c0d1b89a483e7eebd2"><div class="ttname"><a href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">hx711_t::_state_mach</a></div><div class="ttdeci">uint _state_mach</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00079">hx711.h:79</a></div></div>
<div class="ttc" id="astructhx711__t_html_af407d4b03897c4dd73f6285059d99005"><div class="ttname"><a href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">hx711_t::_mut</a></div><div class="ttdeci">mutex_t _mut</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00082">hx711.h:82</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00080">hx711_t::_offset</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00077">hx711_t::_prog</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, and <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>.</p>

</div>
</div>
<a id="a2a490345d56d3d9f06f809c07446a6e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a490345d56d3d9f06f809c07446a6e5">&#9670;&nbsp;</a></span>hx711_get_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t hx711_get_value </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtains a value from the HX711. Blocks until a value is available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int32_t </dd></dl>
<p>Block until a value is available</p>
<p>NOTE: remember that reading from the RX FIFO simultaneously clears it. That's why we can keep calling this function hx711_get_value and be assured we'll be getting a new value each time, even if the RX FIFO is currently empty.</p>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00197">197</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                           {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">const</span> uint32_t rawVal = pio_sm_get_blocking(</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="hx711_8h.html#a356fb6b43100e2ff2d80a83c6e40b6a5">hx711_get_twos_comp</a>(rawVal);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div>
<div class="ttc" id="ahx711_8h_html_a356fb6b43100e2ff2d80a83c6e40b6a5"><div class="ttname"><a href="hx711_8h.html#a356fb6b43100e2ff2d80a83c6e40b6a5">hx711_get_twos_comp</a></div><div class="ttdeci">static int32_t hx711_get_twos_comp(const uint32_t raw)</div><div class="ttdoc">Convert a raw value from the HX711 to a 32-bit signed int.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00132">hx711.h:132</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>, and <a class="el" href="hx711_8h_source.html#l00132">hx711_get_twos_comp()</a>.</p>

</div>
</div>
<a id="a0c8ff19b682c8518252a5d6ed67d6598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c8ff19b682c8518252a5d6ed67d6598">&#9670;&nbsp;</a></span>hx711_get_value_noblock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool hx711_get_value_noblock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *const&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtains a value from the HX711. Returns immediately if no value is available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
    <tr><td class="paramname">val</td><td>pointer to the value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a value was available and val is set </dd>
<dd>
false if a value was not available </dd></dl>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00254">254</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        assert(val != NULL);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordtype">bool</span> success;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        uint32_t tempVal;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        success = <a class="code" href="hx711_8h.html#a95a39180249d252d709cd465d1eaeaa2">hx711__try_get_value</a>(hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>, hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>, &amp;tempVal);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">if</span>(success) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            *val = <a class="code" href="hx711_8h.html#a356fb6b43100e2ff2d80a83c6e40b6a5">hx711_get_twos_comp</a>(tempVal);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">return</span> success;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
<div class="ttc" id="ahx711_8h_html_a95a39180249d252d709cd465d1eaeaa2"><div class="ttname"><a href="hx711_8h.html#a95a39180249d252d709cd465d1eaeaa2">hx711__try_get_value</a></div><div class="ttdeci">static bool hx711__try_get_value(PIO const pio, const uint sm, uint32_t *const val)</div><div class="ttdoc">Attempts to obtain a value from the PIO RX FIFO if one is available.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00264">hx711.h:264</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>, <a class="el" href="hx711_8h_source.html#l00264">hx711__try_get_value()</a>, and <a class="el" href="hx711_8h_source.html#l00132">hx711_get_twos_comp()</a>.</p>

</div>
</div>
<a id="a0ab1a8852812daf235cf743f530cf037"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ab1a8852812daf235cf743f530cf037">&#9670;&nbsp;</a></span>hx711_get_value_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool hx711_get_value_timeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *const&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtains a value from the HX711. Blocks until a value is available or the timeout is reached. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
    <tr><td class="paramname">timeout</td><td>maximum time to wait for a value in microseconds </td></tr>
    <tr><td class="paramname">val</td><td>pointer to the value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a value was obtained within the timeout </dd>
<dd>
false if a timeout was reached </dd></dl>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00222">222</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        assert(val != NULL);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordtype">bool</span> success = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">const</span> absolute_time_t endTime = make_timeout_time_us(timeout);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        uint32_t tempVal;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        assert(!is_nil_time(endTime));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">while</span>(!time_reached(endTime)) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span>((success = <a class="code" href="hx711_8h.html#a95a39180249d252d709cd465d1eaeaa2">hx711__try_get_value</a>(hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>, hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>, &amp;tempVal))) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span>(success) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            *val = <a class="code" href="hx711_8h.html#a356fb6b43100e2ff2d80a83c6e40b6a5">hx711_get_twos_comp</a>(tempVal);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">return</span> success;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>, <a class="el" href="hx711_8h_source.html#l00264">hx711__try_get_value()</a>, and <a class="el" href="hx711_8h_source.html#l00132">hx711_get_twos_comp()</a>.</p>

</div>
</div>
<a id="a20c562c58345b4cb4c8922925ec0a877"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20c562c58345b4cb4c8922925ec0a877">&#9670;&nbsp;</a></span>hx711_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hx711_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint&#160;</td>
          <td class="paramname"><em>clk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint&#160;</td>
          <td class="paramname"><em>dat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PIO const&#160;</td>
          <td class="paramname"><em>pio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const pio_program_t *const&#160;</td>
          <td class="paramname"><em>prog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="hx711_8h.html#a90174ad7869dcc222ee9d6aef3e3b097">hx711_program_init_t</a>&#160;</td>
          <td class="paramname"><em>prog_init_func</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise HX711. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td>Pointer to <a class="el" href="structhx711__t.html">hx711_t</a> </td></tr>
    <tr><td class="paramname">clk</td><td>GPIO pin connected to HX711 CLK pin </td></tr>
    <tr><td class="paramname">dat</td><td>GPIO pin connected to HX711 DAT pin </td></tr>
    <tr><td class="paramname">pio</td><td>RP2040 PIO pio0 or pio1 </td></tr>
    <tr><td class="paramname">prog</td><td>PIO program </td></tr>
    <tr><td class="paramname">prog_init_func</td><td>PIO initalisation function </td></tr>
  </table>
  </dd>
</dl>
<p>There was originally a call here to gpio_put on the clock pin to power up the HX711. I have decided to remove this and also remove enabling the state machine from the pio init function. This does leave the HX711's power state undefined from the perspective of the code, but does give a much clearer separation of duties. This function merely init's the hardware and state machine, and the hx711_set_power function sets the power and enables/disables the state machine.</p>
<p>There was originally a call here to gpio_pull_up on the data pin to prevent erroneous data ready states. This was incorrect. Page 4 of the datasheet states: "The 25th pulse at PD_SCK input will pull
DOUT pin back to high (Fig.2)."</p>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00026">26</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                         {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        assert(hx != NULL);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        assert(pio != NULL);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        assert(prog != NULL);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        assert(prog_init_func != NULL);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        assert(pio_can_add_program(pio, prog));</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        mutex_init(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">clock_pin</a> = clk;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a312ea334754714f8f7865608e40b7654">data_pin</a> = dat;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a> = pio;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a6582187b36ed9f636945d2af35232dbc">_prog</a> = prog;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        gpio_init(hx-&gt;<a class="code" href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">clock_pin</a>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        gpio_set_dir(hx-&gt;<a class="code" href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">clock_pin</a>, GPIO_OUT);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        gpio_init(hx-&gt;<a class="code" href="structhx711__t.html#a312ea334754714f8f7865608e40b7654">data_pin</a>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        gpio_set_dir(hx-&gt;<a class="code" href="structhx711__t.html#a312ea334754714f8f7865608e40b7654">data_pin</a>, GPIO_IN);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">//either statement below will panic if it fails</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a0c14f4e62aa6ee1f56b941a87e214ce4">_offset</a> = pio_add_program(hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>, hx-&gt;<a class="code" href="structhx711__t.html#a6582187b36ed9f636945d2af35232dbc">_prog</a>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a> = (uint)pio_claim_unused_sm(hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        prog_init_func(hx);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="ttc" id="astructhx711__t_html_a00860359bbb10538dfe45ffc0f2a2a0d"><div class="ttname"><a href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">hx711_t::clock_pin</a></div><div class="ttdeci">uint clock_pin</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00073">hx711.h:73</a></div></div>
<div class="ttc" id="astructhx711__t_html_a312ea334754714f8f7865608e40b7654"><div class="ttname"><a href="structhx711__t.html#a312ea334754714f8f7865608e40b7654">hx711_t::data_pin</a></div><div class="ttdeci">uint data_pin</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00074">hx711.h:74</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00080">hx711_t::_offset</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00077">hx711_t::_prog</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00073">hx711_t::clock_pin</a>, and <a class="el" href="hx711_8h_source.html#l00074">hx711_t::data_pin</a>.</p>

</div>
</div>
<a id="a02e3733a8c520e26cb44caac32945c63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02e3733a8c520e26cb44caac32945c63">&#9670;&nbsp;</a></span>hx711_set_gain()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hx711_set_gain </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="hx711_8h.html#acadec7365abc52889994131164536304">hx711_gain_t</a>&#160;</td>
          <td class="paramname"><em>gain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets HX711 gain. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
    <tr><td class="paramname">gain</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>gain value is 0-based and calculated by: gain = clock pulses - 24 - 1 ie. gain of 128 is 25 clock pulses, so gain = 25 - 24 - 1 gain = 0</p>
<p>Before putting anything in the TX FIFO buffer, assume the worst-case scenario which is that there's something already in there. There ought not to be, but clearing it ensures the following pio_sm_put* call does not need to block as this function to change the gain should take precedence.</p>
<p>At this point the current value in the RX FIFO will have been calculated based on whatever the previous set gain was. So, the RX FIFO needs to be cleared.</p>
<p>NOTE: checking for whether the RX FIFO is not empty won't work. A conversion may have already begun before any bits have been moved into the ISR.</p>
<p>UPDATE: the worst-case scenario here is that the pio_sm_put call has occurred after the pio "pull", because we then need to wait until the following "pull" in the state machine. If this happens:</p>
<ol type="1">
<li>there may already be a value in the RX FIFO; and</li>
<li>another value will need to be read and discarded following which the new gain will be set.</li>
</ol>
<p>To handle 1.: Clear the RX FIFO with a non-blocking read. If the RX FIFO is empty, no harm done because the call won't block.</p>
<p>To handle 2.: Read the "next" value with a blocking read to ensure the "next, next" value will be set to the desired gain.</p>
<p>Immediately following the above blocking call, the state machine will pull in the data in the pio_sm_put call above and pulse the HX711 the correct number of times to set the desired gain.</p>
<p>No further communication with the state machine from this function is required. Any other function(s) wishing to obtain a value from the HX711 need only block until one is there (or check the RX FIFO level).</p>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00109">109</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                                                {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">const</span> uint32_t gainVal = (uint32_t)gain - <a class="code" href="hx711_8h.html#ab9b9f8da4c67723ef2bf5e632aee5a80">HX711_READ_BITS</a> - 1;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    assert(gainVal &lt;= 2);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    pio_sm_drain_tx_fifo(</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    pio_sm_put(</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        gainVal);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">//1. clear the RX FIFO with the non-blocking read</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    pio_sm_get(</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">//2. wait until the value from the currently-set gain</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">//can be safely read and discarded</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    pio_sm_get_blocking(</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="ttc" id="ahx711_8h_html_ab9b9f8da4c67723ef2bf5e632aee5a80"><div class="ttname"><a href="hx711_8h.html#ab9b9f8da4c67723ef2bf5e632aee5a80">HX711_READ_BITS</a></div><div class="ttdeci">static const uint HX711_READ_BITS</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00037">hx711.h:37</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>, and <a class="el" href="hx711_8h_source.html#l00037">HX711_READ_BITS</a>.</p>

</div>
</div>
<a id="aa47929fdc96d757b9306dd57ef752a20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa47929fdc96d757b9306dd57ef752a20">&#9670;&nbsp;</a></span>hx711_set_power()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hx711_set_power </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhx711__t.html">hx711_t</a> *const&#160;</td>
          <td class="paramname"><em>hx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657">hx711_power_t</a>&#160;</td>
          <td class="paramname"><em>pwr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes the power state of the HX711. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hx</td><td></td></tr>
    <tr><td class="paramname">pwr</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>NOTE: pio_sm_restart should not be used here. That function clears the clock divider which is currently set in the dedicated pio init function.</p>
<ol type="1">
<li>set the clock pin low to power up the chip</li>
</ol>
<p>There does not appear to be any delay after powering up. Any actual delay would presumably be dealt with by the HX711 prior to the data pin going low. Which, in turn, is handled by the state machine in waiting for the low signal.</p>
<ol type="1">
<li>set clock pin high to start the power down process</li>
</ol>
<p>NOTE: the HX711 chip requires the clock pin to be held high for 60+ us calling functions should therefore do:</p>
<p>hx711_set_power(hx, hx711_pwr_down); <a class="el" href="hx711_8h.html#af76e111ac6776cb7c4321dab53bf8036" title="Convenience function for sleeping for the appropriate amount of time to allow the HX711 to power down...">hx711_wait_power_down()</a>;</p>

<p class="definition">Definition at line <a class="el" href="hx711_8c_source.html#l00278">278</a> of file <a class="el" href="hx711_8c_source.html">hx711.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                                                 {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="hx711_8h.html#ae2674564ac2b0b3f0cfda56e0a970f07">hx711__assert_hx_initd</a>(hx);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    mutex_enter_blocking(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span>(pwr == <a class="code" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098">hx711_pwr_up</a>) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        gpio_put(hx-&gt;<a class="code" href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">clock_pin</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">//2. reset the state machine using the default config</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">//obtained when init&#39;ing.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        pio_sm_init(</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a0c14f4e62aa6ee1f56b941a87e214ce4">_offset</a>,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            &amp;hx-&gt;<a class="code" href="structhx711__t.html#a8f0e2e7b6f3ea65f449d59ba30f474c2">_default_config</a>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">//3. start the state machine</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        pio_sm_set_enabled(</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keyword">true</span>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pwr == <a class="code" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1">hx711_pwr_down</a>) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">//1. stop the state machine</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        pio_sm_set_enabled(</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a77b81a68b9304dc653e393215beacd77">_pio</a>,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            hx-&gt;<a class="code" href="structhx711__t.html#a8574e280638286c0d1b89a483e7eebd2">_state_mach</a>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keyword">false</span>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        gpio_put(hx-&gt;<a class="code" href="structhx711__t.html#a00860359bbb10538dfe45ffc0f2a2a0d">clock_pin</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    mutex_exit(&amp;hx-&gt;<a class="code" href="structhx711__t.html#af407d4b03897c4dd73f6285059d99005">_mut</a>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div>
<div class="ttc" id="ahx711_8h_html_a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1"><div class="ttname"><a href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1">hx711_pwr_down</a></div><div class="ttdeci">@ hx711_pwr_down</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00069">hx711.h:68</a></div></div>
<div class="ttc" id="ahx711_8h_html_a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098"><div class="ttname"><a href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098">hx711_pwr_up</a></div><div class="ttdeci">@ hx711_pwr_up</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00067">hx711.h:67</a></div></div>
<div class="ttc" id="astructhx711__t_html_a8f0e2e7b6f3ea65f449d59ba30f474c2"><div class="ttname"><a href="structhx711__t.html#a8f0e2e7b6f3ea65f449d59ba30f474c2">hx711_t::_default_config</a></div><div class="ttdeci">pio_sm_config _default_config</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00078">hx711.h:78</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="hx711_8h_source.html#l00078">hx711_t::_default_config</a>, <a class="el" href="hx711_8h_source.html#l00082">hx711_t::_mut</a>, <a class="el" href="hx711_8h_source.html#l00080">hx711_t::_offset</a>, <a class="el" href="hx711_8h_source.html#l00076">hx711_t::_pio</a>, <a class="el" href="hx711_8h_source.html#l00079">hx711_t::_state_mach</a>, <a class="el" href="hx711_8h_source.html#l00073">hx711_t::clock_pin</a>, <a class="el" href="hx711_8h_source.html#l00288">hx711__assert_hx_initd()</a>, <a class="el" href="hx711_8h_source.html#l00068">hx711_pwr_down</a>, and <a class="el" href="hx711_8h_source.html#l00067">hx711_pwr_up</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="hx711_8c.html">hx711.c</a></li>
    <li class="footer">Generated on Sat Jan 7 2023 10:03:02 for hx711-pico-c by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
