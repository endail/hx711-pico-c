<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hx711-pico-c: hx711-pico-c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">hx711-pico-c
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">hx711-pico-c </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is my implementation of reading from a HX711 via a Raspberry Pi Pico. It uses the RP2040's PIO feature to be as efficient as possible.</p>
<p><b>NOTE</b>: if you are looking for a method to weigh objects (ie. by using the HX711 as a scale), see <a href="https://github.com/endail/pico-scale">pico-scale</a>.</p>
<p><img src="resources/hx711_serialout.gif" alt="resources/hx711_serialout.gif" class="inline"/></p>
<p>The .gif above illustrates the <a href="main.c">current example code</a> obtaining data from a HX711 operating at 80 samples per second.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Clone Repository</h1>
<div class="fragment"><div class="line">git clone https://github.com/endail/hx711-pico-c</div>
</div><!-- fragment --><p>Alternatively, include it as a submodule in your project and then <code>#include "extern/hx711-pico-c/include/hx711.h"</code> and <code>#include "extern/hx711-pico-c/include/hx711_noblock.pio.h"</code>.</p>
<div class="fragment"><div class="line">git submodule add https://github.com/endail/hx711-pico-c extern/</div>
<div class="line">git submodle update --init</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p><a href="https://endail.github.io/hx711-pico-c/hx711_8h.html">https://endail.github.io/hx711-pico-c</a></p>
<h1><a class="anchor" id="autotoc_md3"></a>
How to Use</h1>
<p>See <a href="https://learn.adafruit.com/assets/99339">here</a> for a pinout to choose two GPIO pins on the Pico (RP2040). One GPIO pin to connect to the HX711's clock pin and a second GPIO pin to connect to the HX711's data pin. You can choose any two pins as the clock and data pins, as long as they are capable of digital output and input respectively.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hx711_8h.html">include/hx711.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="hx711__noblock_8pio_8h.html">include/hx711_noblock.pio.h</a>&quot;</span> <span class="comment">// for hx711_noblock_program and hx711_noblock_program_init</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structhx711__t.html">hx711_t</a> hx;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 1. Initialise the HX711</span></div>
<div class="line"><a class="code" href="hx711_8h.html#a20c562c58345b4cb4c8922925ec0a877">hx711_init</a>(</div>
<div class="line">    &amp;hx,</div>
<div class="line">    clkPin, <span class="comment">// Pico GPIO pin connected to HX711&#39;s clock pin</span></div>
<div class="line">    datPin, <span class="comment">// Pico GPIO pin connected to HX711&#39;s data pin</span></div>
<div class="line">    pio0, <span class="comment">// the RP2040 PIO to use (either pio0 or pio1)</span></div>
<div class="line">    &amp;<a class="code" href="hx711__noblock_8pio_8h.html#a116dfe25b456231a2eada965de465101">hx711_noblock_program</a>, <span class="comment">// the state machine program</span></div>
<div class="line">    &amp;<a class="code" href="hx711__noblock_8pio_8h.html#a2a7669554165d3956d65c5f643c022c1">hx711_noblock_program_init</a>); <span class="comment">// the state machine program init function</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 2. Power up</span></div>
<div class="line"><a class="code" href="hx711_8h.html#aa47929fdc96d757b9306dd57ef752a20">hx711_set_power</a>(&amp;hx, <a class="code" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098">hx711_pwr_up</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. [OPTIONAL] set gain and save it to the HX711</span></div>
<div class="line"><span class="comment">// chip by powering down then back up</span></div>
<div class="line"><a class="code" href="hx711_8h.html#a02e3733a8c520e26cb44caac32945c63">hx711_set_gain</a>(&amp;hx, <a class="code" href="hx711_8h.html#acadec7365abc52889994131164536304aa9da6f32e4c6b52bf5c07d6670f942e1">hx711_gain_128</a>);</div>
<div class="line"><a class="code" href="hx711_8h.html#aa47929fdc96d757b9306dd57ef752a20">hx711_set_power</a>(&amp;hx, <a class="code" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1">hx711_pwr_down</a>);</div>
<div class="line"><a class="code" href="hx711_8h.html#af76e111ac6776cb7c4321dab53bf8036">hx711_wait_power_down</a>();</div>
<div class="line"><a class="code" href="hx711_8h.html#aa47929fdc96d757b9306dd57ef752a20">hx711_set_power</a>(&amp;hx, <a class="code" href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098">hx711_pwr_up</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4. Wait for readings to settle</span></div>
<div class="line"><a class="code" href="hx711_8h.html#a5495b51ec048d8363783a572fb577ecc">hx711_wait_settle</a>(<a class="code" href="hx711_8h.html#aa32021164bb71485f28db91a7c5c776fa40b58161d4eeb9860f339f0309fafa33">hx711_rate_10</a>); <span class="comment">// or hx711_rate_80 depending on your chip&#39;s config</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 5. Read values</span></div>
<div class="line">int32_t val;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// wait (block) until a value is read</span></div>
<div class="line">val = <a class="code" href="hx711_8h.html#a2a490345d56d3d9f06f809c07446a6e5">hx711_get_value</a>(&amp;hx);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// or use a timeout</span></div>
<div class="line"><span class="comment">// #include &quot;pico/time.h&quot; to use make_timeout_time_ms and make_timeout_time_us functions</span></div>
<div class="line">absolute_time_t timeout = make_timeout_time_ms(250);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(<a class="code" href="hx711_8h.html#a883615f6bc134c760b61e5eefa0443f4">hx711_get_value_timeout</a>(&amp;hx, &amp;timeout, &amp;val)) {</div>
<div class="line">    <span class="comment">// value was obtained within the timeout period</span></div>
<div class="line">    <span class="comment">// in this example, within 250ms</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;%li\n&quot;</span>, val);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Custom PIO Programs</h1>
<p>You will notice in the code example above that you need to manually include the <code><a class="el" href="hx711__noblock_8pio_8h.html">hx711_noblock.pio.h</a></code> PIO header file. This is because it is not included by default in the <code>hx711-pico-c</code> library. It is offered as <em>a method</em> for reading from the HX711 that I have optimised as much as possible to run as efficiently as possible. But there is nothing stopping you from creating your own PIO program and using it with the <code><a class="el" href="structhx711__t.html">hx711_t</a></code>. In fact, if you do want to make your own HX711 PIO program, you only need to do the following:</p>
<h2><a class="anchor" id="autotoc_md5"></a>
hx711_init</h2>
<ol type="1">
<li>Pass the <code>pio_program_t*</code> pointer created by <code>pioasm</code> in the Pico SDK (automatically done for you when calling <code>pico_generate_pio_header()</code> in your <code>CMakeLists.txt</code> file).</li>
<li>Pass a function pointer to an initialisation function which sets up the PIO program (but does <em>not</em> start it) which takes a pointer to the <code><a class="el" href="structhx711__t.html">hx711_t</a></code> struct as its only argument. ie. <code>void (*hx711_program_init_t)(hx711_t* const)</code>.</li>
</ol>
<p>The call to <code>hx711_init</code> should look like this:</p>
<div class="fragment"><div class="line"><a class="code" href="hx711_8h.html#a20c562c58345b4cb4c8922925ec0a877">hx711_init</a>(</div>
<div class="line">    &amp;hx,</div>
<div class="line">    clkPin,</div>
<div class="line">    datPin,</div>
<div class="line">    pio0,</div>
<div class="line">    your_pio_program_created_by_pioasm,</div>
<div class="line">    your_pio_initialisation_function);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Passing HX711 Values From PIO to Code</h2>
<p>The two functions for obtaining values, <code>hx711_get_value</code> and <code>hx711_get_value_timeout</code>, both expect the raw, unsigned value from the HX711 according to the datasheet. There should be 24 bits (ie. 3 bytes) with the most significant bit first.</p>
<p><code>hx711_get_value</code> is a blocking function. It will wait until the RX FIFO is not empty.</p>
<p><code>hx711_get_value_timeout</code> is also blocking function with a timeout. It will watch the RX FIFO until there are at least 3 bytes.</p>
<p>Both functions will subsequently read from and clear the RX FIFO.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Setting HX711 Gain</h2>
<p><code>hx711_set_gain</code> will transmit an unsigned 32 bit integer to the PIO program which represents the gain to set. This integer will be in the range 0 to 2 inclusive, corresponding to a HX711 gain of 128, 32, and 64 respectively.</p>
<p>The function will then perform two sequential PIO reads. The first is a non-blocking read to clear whatever is in the RX FIFO, followed by a blocking read to give the PIO program as long as it needs to finish reading the previously set gain.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Setting HX711 Power</h2>
<p>The PIO program should <em>not</em> attempt to change the HX711's power state. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="ahx711_8h_html_af76e111ac6776cb7c4321dab53bf8036"><div class="ttname"><a href="hx711_8h.html#af76e111ac6776cb7c4321dab53bf8036">hx711_wait_power_down</a></div><div class="ttdeci">static void hx711_wait_power_down()</div><div class="ttdoc">Convenience function for sleeping for the appropriate amount of time to allow the HX711 to power down...</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00243">hx711.h:243</a></div></div>
<div class="ttc" id="ahx711_8h_html_acadec7365abc52889994131164536304aa9da6f32e4c6b52bf5c07d6670f942e1"><div class="ttname"><a href="hx711_8h.html#acadec7365abc52889994131164536304aa9da6f32e4c6b52bf5c07d6670f942e1">hx711_gain_128</a></div><div class="ttdeci">@ hx711_gain_128</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00060">hx711.h:60</a></div></div>
<div class="ttc" id="ahx711_8h_html"><div class="ttname"><a href="hx711_8h.html">hx711.h</a></div></div>
<div class="ttc" id="ahx711_8h_html_a02e3733a8c520e26cb44caac32945c63"><div class="ttname"><a href="hx711_8h.html#a02e3733a8c520e26cb44caac32945c63">hx711_set_gain</a></div><div class="ttdeci">void hx711_set_gain(hx711_t *const hx, const hx711_gain_t gain)</div><div class="ttdoc">Sets HX711 gain.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8c_source.html#l00112">hx711.c:112</a></div></div>
<div class="ttc" id="ahx711_8h_html_a2a490345d56d3d9f06f809c07446a6e5"><div class="ttname"><a href="hx711_8h.html#a2a490345d56d3d9f06f809c07446a6e5">hx711_get_value</a></div><div class="ttdeci">int32_t hx711_get_value(hx711_t *const hx)</div><div class="ttdoc">Returns a value from the HX711. Blocks until a value is available.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8c_source.html#l00203">hx711.c:203</a></div></div>
<div class="ttc" id="ahx711__noblock_8pio_8h_html_a2a7669554165d3956d65c5f643c022c1"><div class="ttname"><a href="hx711__noblock_8pio_8h.html#a2a7669554165d3956d65c5f643c022c1">hx711_noblock_program_init</a></div><div class="ttdeci">void hx711_noblock_program_init(hx711_t *const hx)</div><div class="ttdef"><b>Definition:</b> <a href="hx711__noblock_8pio_8h_source.html#l00076">hx711_noblock.pio.h:76</a></div></div>
<div class="ttc" id="ahx711__noblock_8pio_8h_html"><div class="ttname"><a href="hx711__noblock_8pio_8h.html">hx711_noblock.pio.h</a></div></div>
<div class="ttc" id="ahx711_8h_html_a883615f6bc134c760b61e5eefa0443f4"><div class="ttname"><a href="hx711_8h.html#a883615f6bc134c760b61e5eefa0443f4">hx711_get_value_timeout</a></div><div class="ttdeci">bool hx711_get_value_timeout(hx711_t *const hx, const absolute_time_t *const timeout, int32_t *const val)</div><div class="ttdoc">Returns a value from the HX711. Blocks until a value is available or the timeout is reached.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8c_source.html#l00231">hx711.c:231</a></div></div>
<div class="ttc" id="ahx711_8h_html_aa47929fdc96d757b9306dd57ef752a20"><div class="ttname"><a href="hx711_8h.html#aa47929fdc96d757b9306dd57ef752a20">hx711_set_power</a></div><div class="ttdeci">void hx711_set_power(hx711_t *const hx, const hx711_power_t pwr)</div><div class="ttdoc">Changes the power state of the HX711.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8c_source.html#l00268">hx711.c:268</a></div></div>
<div class="ttc" id="ahx711_8h_html_a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1"><div class="ttname"><a href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a5238e62eed59a89c8817f06dc65b85a1">hx711_pwr_down</a></div><div class="ttdeci">@ hx711_pwr_down</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00067">hx711.h:67</a></div></div>
<div class="ttc" id="ahx711_8h_html_a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098"><div class="ttname"><a href="hx711_8h.html#a69bd1e90c3893a185a5e615db96ef657a82eebd84cc006a432437b2798644d098">hx711_pwr_up</a></div><div class="ttdeci">@ hx711_pwr_up</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00066">hx711.h:66</a></div></div>
<div class="ttc" id="astructhx711__t_html"><div class="ttname"><a href="structhx711__t.html">hx711_t</a></div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00070">hx711.h:70</a></div></div>
<div class="ttc" id="ahx711__noblock_8pio_8h_html_a116dfe25b456231a2eada965de465101"><div class="ttname"><a href="hx711__noblock_8pio_8h.html#a116dfe25b456231a2eada965de465101">hx711_noblock_program</a></div><div class="ttdeci">static const struct pio_program hx711_noblock_program</div><div class="ttdef"><b>Definition:</b> <a href="hx711__noblock_8pio_8h_source.html#l00036">hx711_noblock.pio.h:36</a></div></div>
<div class="ttc" id="ahx711_8h_html_a20c562c58345b4cb4c8922925ec0a877"><div class="ttname"><a href="hx711_8h.html#a20c562c58345b4cb4c8922925ec0a877">hx711_init</a></div><div class="ttdeci">void hx711_init(hx711_t *const hx, const uint clk, const uint dat, PIO const pio, const pio_program_t *const prog, hx711_program_init_t prog_init_func)</div><div class="ttdoc">Initialise HX711.</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8c_source.html#l00026">hx711.c:26</a></div></div>
<div class="ttc" id="ahx711_8h_html_a5495b51ec048d8363783a572fb577ecc"><div class="ttname"><a href="hx711_8h.html#a5495b51ec048d8363783a572fb577ecc">hx711_wait_settle</a></div><div class="ttdeci">static void hx711_wait_settle(const hx711_rate_t rate)</div><div class="ttdoc">Convenience function for sleeping for the appropriate amount of time according to the given sample ra...</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00234">hx711.h:234</a></div></div>
<div class="ttc" id="ahx711_8h_html_aa32021164bb71485f28db91a7c5c776fa40b58161d4eeb9860f339f0309fafa33"><div class="ttname"><a href="hx711_8h.html#aa32021164bb71485f28db91a7c5c776fa40b58161d4eeb9860f339f0309fafa33">hx711_rate_10</a></div><div class="ttdeci">@ hx711_rate_10</div><div class="ttdef"><b>Definition:</b> <a href="hx711_8h_source.html#l00050">hx711.h:50</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Aug 6 2022 16:27:51 for hx711-pico-c by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
